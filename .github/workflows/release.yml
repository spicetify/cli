name: Release

on:
   release:
      types: [published]

jobs:
   release:
      permissions:
         id-token: write
         contents: write
         attestations: write
      name: Release
      strategy:
         matrix:
            os: ["linux", "darwin", "windows"]
      runs-on: ubuntu-latest
      if: startsWith(github.ref, 'refs/tags/v3')

      steps:
      -  name: Set Env
         run: echo "TAG=${GITHUB_REF#refs/*/v}" >> $GITHUB_ENV

      -  name: Checkout
         uses: actions/checkout@v4

      -  uses: ./.github/actions/release
         with:
            platform: ${{ matrix.os }}
            tag: ${{ env.TAG }}
            GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
